{# Copyright (C) Takeshi Nakamura. All rights reserved. #}

{% extends 'money/base.html' %}

{% load humanize %}
{% load i18n %}

{% load html %}
{% load url %}

{% load journal %}

{% block head %}
{% include 'money/css_symbol.html' %}
{% endblock %}

{% block title %}{% trans 'Journals' %} | {{ NAME }}{% endblock %}

{% block breadcrumb %}
<a href="{% url 'money:home' %}">{% trans 'Home' %}</a>
&raquo;
<a href="{% url 'money:journals' %}">{% trans 'Journals' %}</a>
&raquo;
{% trans 'New' %}
{% endblock %}

{% block heading %}{% trans 'New journal' %}{% endblock %}

{% block actions %}
{% endblock %}

{% block content %}
{% endblock %}

{% block sidebar %}
{% endblock %}

{% block content_full %}
<form method="post">
  {% csrf_token %}

<div class="d-flex justify-content-end mb-3">

{% if popular_account %}
<div class="dropdown">
  <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-toggle="dropdown">
    {% trans 'Popular account' %}
  </button>
  <div id="popular" class="dropdown-menu dropdown-menu-right">
    {% for x in popular_account %}
    <a class="dropdown-item" href="#" data-debit="{{ x.debit__id }}" data-credit="{{ x.credit__id }}">{{ x.debit__name }} / {{ x.credit__name }}</a>
    {% endfor %}
  </div>
</div>
{% endif %}

</div><!-- .d-flex -->

<div class="form-group row">
  <label class="col-sm-3 col-form-label">{% trans 'Debit' %} <span class="symbol-required"></span></label>
  <div class="col-sm-9">
    <select name="debit" class="form-control">
      {% for x in account %}
      <optgroup label="{{ x.name }}">
        {% for y in x.data %}
        <option value="{{ y.id }}" {% html_selected_if_eq object.debit.id y.id %}>{{ y.name }}</option>
        {% endfor %}
      </optgroup>
      {% endfor %}
    </select>
  </div>
</div>

<div class="form-group row">
  <label class="col-sm-3 col-form-label">{% trans 'Credit' %} <span class="symbol-required"></span></label>
  <div class="col-sm-9">
    <select name="credit" class="form-control">
      {% for x in account %}
      <optgroup label="{{ x.name }}">
        {% for y in x.data %}
        <option value="{{ y.id }}" {% html_selected_if_eq object.credit.id y.id %}>{{ y.name }}</option>
        {% endfor %}
      </optgroup>
      {% endfor %}
    </select>
  </div>
</div>

<div class="form-group row">
  <label class="col-sm-3 col-form-label">{% trans 'Date' %} <span class="symbol-required"></span></label>
  <div class="col-sm-9">
    <div id="date" class="input-group date datetimepicker" data-target-input="nearest">
      <input type="text" name="date" value="{% now 'Y-m-d' %}" class="form-control datetimepicker-input" data-target="#date" />
      <div class="input-group-append" data-target="#date" data-toggle="datetimepicker">
        <div class="input-group-text"><i class="fas fa-calendar fa-fw"></i></div>
      </div>
    </div>
  </div>
</div>

<div class="form-group row">
  <label class="col-sm-3 col-form-label">{% trans 'Amount' %} <span class="symbol-required"></span></label>
  <div class="col-sm-9">
    <input type="number" name="amount" value="{{ object.amount }}" class="form-control" required>
  </div>
</div>

<div class="form-group row">
  <label class="col-sm-3 col-form-label">{% trans 'Summary' %} <span class="symbol-required"></span></label>
  <div class="col-sm-9">
    <input type="text" name="summary" value="{{ object.summary|default:'' }}" class="form-control" required>
  </div>
</div>

<div class="form-group row">
  <label class="col-sm-3 col-form-label">{% trans 'Note' %}</label>
  <div class="col-sm-9">
    <textarea name="note" class="form-control" rows="3">{{ object.note|default:'' }}</textarea>
  </div>
</div>

<div class="row mt-4">
  <div class="col">
    <button type="submit" class="btn btn-primary mr-2"><i class="fas fa-check fa-fw"></i> {% trans 'Submit' %}</button>
    {% if request.GET.next %}
    <a href="{{ request.GET.next }}" class="btn btn-secondary"><i class="fas fa-ban fa-fw"></i> {% trans 'Cancel' %}</a>
    {% else %}
    <a href="{% url 'money:journals' %}" class="btn btn-secondary"><i class="fas fa-ban fa-fw"></i> {% trans 'Cancel' %}</a>
    {% endif %}
  </div>
</div>

</form>
{% endblock %}

{% block js %}
{% include 'money/js_moment.html' %}
{% include 'money/js_datetimepicker.html' %}
<script>
$(function() {
  $('.datetimepicker').datetimepicker({format: 'YYYY-MM-DD'});

  $('#popular a').on('click', function(e) {
    e.preventDefault();

    $('select[name="debit"]').val($(this).data('debit'));
    $('select[name="credit"]').val($(this).data('credit'));
  });
});
</script>
{% endblock %}
