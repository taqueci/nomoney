{# Copyright (C) Takeshi Nakamura. All rights reserved. #}

{% extends 'money/base.html' %}

{% load humanize %}
{% load i18n %}

{% load html %}
{% load url %}

{% load journal %}

{% block head %}
{% endblock %}

{% block title %}{% trans 'Journals' %} | {{ NAME }}{% endblock %}

{% block breadcrumb %}
<a href="{% url 'money:home' %}">{% trans 'Home' %}</a>
&raquo;
{% trans 'Journals' %}
{% endblock %}

{% block heading %}{% trans 'Journal list' %}{% endblock %}

{% block actions %}
<a href="{% url 'money:new_journal' %}?next={{ request.get_full_path|urlencode }}" class="btn btn-outline-secondary btn-sm"><i class="fas fa-plus fa-fw"></i> {% trans 'New' %}</a>
{% endblock %}

{% block content %}
<table class="table">
  <thead>
    <tr>
      <th><a href="?{% url_params_sort 'id' %}">#</a></th>
      <th><a href="?{% url_params_sort 'date' %}">{% trans 'Date' %}</a></th>
      <th><a href="?{% url_params_sort 'debit' %}">{% trans 'Debit' %}</a></th>
      <th><a href="?{% url_params_sort 'debit' %}">{% trans 'Credit' %}</a></th>
      <th><a href="?{% url_params_sort 'amount' %}">{% trans 'Amount' %}</a></th>
      <th></th>
      <th><a href="?{% url_params_sort 'summary' %}">{% trans 'Summary' %}</a></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for x in page %}
    <tr>
      <td align="right">{{ x.id }}</td>
      <td>{{ x.date|date:'Y-m-d' }}</td>
      <td>{{ x.debit.name }}</td>
      <td>{{ x.credit.name }}</td>
      <td align="right">{{ x.amount|intcomma }}</td>
      <td><span class="{{ x|journal_category_badge_class }}">{{ x|journal_category_text }}</span></td>
      <td>{{ x.summary }}</td>
      <td class="px-2">
        <span data-toggle="tooltip" data-title="{% trans 'More information' %}"><a href="{% url 'money:journal' x.id %}"><i class="fas fa-list-alt fa-fw"></i></a></span>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% include 'money/pagination.html' %}
{% endblock %}

{% block sidebar %}
<div class="mb-5">

<h5 class="border-bottom pb-2 mb-3"><i class="fas fa-filter fa-fw"></i> {% trans 'Filter' %}</h5>

<form id="filter" method="get" action="{% url 'main:journals' %}">

<div class="form-group">
  <label>{% trans 'Start date' %}</label>
  <div id="filter-start" class="input-group date datetimepicker" data-target-input="nearest">
    <input type="text" name="start" value="{% url_param_value 'start' %}" class="form-control datetimepicker-input" data-target="#filter-start" />
    <div class="input-group-append" data-target="#filter-start" data-toggle="datetimepicker">
      <div class="input-group-text"><i class="fas fa-calendar fa-fw"></i></div>
    </div>
  </div>
</div>

<div class="form-group">
  <label>{% trans 'End date' %}</label>
  <div id="filter-end" class="input-group date datetimepicker" data-target-input="nearest">
    <input type="text" name="end" value="{% url_param_value 'end' %}" class="form-control datetimepicker-input" data-target="#filter-end" />
    <div class="input-group-append" data-target="#filter-end" data-toggle="datetimepicker">
      <div class="input-group-text"><i class="fas fa-calendar fa-fw"></i></div>
    </div>
  </div>
</div>

<div class="form-group">
  <label>{% trans 'Debit' %}</label>
  <select name="debit" class="form-control select2" multiple="multiple" size="1">
    {% for x in debit %}
    <option value="{{ x.id }}" {% html_selected_by_query_list 'debit' x.id %} style="visibility: hidden">{{ x.name }}</option>
    {% endfor %}
  </select>
</div>

<div class="form-group">
  <label>{% trans 'Credit' %}</label>
  <select name="credit" class="form-control select2" multiple="multiple" size="1">
    {% for x in credit %}
    <option value="{{ x.id }}" {% html_selected_by_query_list 'credit' x.id %} style="visibility: hidden">{{ x.name }}</option>
    {% endfor %}
  </select>
</div>

</form>

<a class="btn btn-secondary mt-2" href="{% url 'main:journals' %}"><i class="fas fa-ban"></i> {% trans 'Reset' %}</a>

</div>
{% endblock %}

{% block content_full %}
{% endblock %}

{% block js %}
{% include 'money/js_moment.html' %}
{% include 'money/js_datetimepicker.html' %}
{% include 'money/js_select2.html' %}
<script>
$(function() {
  $('[data-toggle="tooltip"]').tooltip();

  $('.datetimepicker').datetimepicker({format: 'YYYY-MM-DD'});
  $('.select2').select2();

  $('#filter').change(function() { $('#filter').submit() });
  $('#filter').on('hide.datetimepicker', function() { $('#filter').submit() });
});
</script>
{% endblock %}
